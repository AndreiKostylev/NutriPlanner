<!-- NutriPlanner/Views/UserPlanViewView.xaml -->
<UserControl x:Class="NutriPlanner.Views.UserPlanViewView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             Background="White">
    
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>
        
        <!-- Заголовок -->
        <TextBlock Grid.Row="0" 
                   Text="Мои планы питания" 
                   FontSize="20" 
                   FontWeight="Bold"
                   Margin="0,0,0,10"/>
        
        <!-- Панель управления датой и планами -->
        <Border Grid.Row="1" 
                BorderBrush="#E0E0E0" 
                BorderThickness="1" 
                CornerRadius="5" 
                Padding="10"
                Margin="0,0,0,10">
            <StackPanel>
                <!-- Управление датой -->
                <StackPanel Orientation="Horizontal" Margin="0,0,0,10">
                    <Button Content="◀" 
                            Command="{Binding PreviousDayCommand}"
                            Width="30" Margin="0,0,10,0"/>
                    
                    <TextBlock Text="{Binding SelectedDate, StringFormat='dd.MM.yyyy'}"
                               VerticalAlignment="Center"
                               FontWeight="Bold"
                               Width="100"
                               TextAlignment="Center"/>
                    
                    <Button Content="▶" 
                            Command="{Binding NextDayCommand}"
                            Width="30" Margin="10,0,20,0"/>
                    
                    <Button Content="Сегодня" 
                            Command="{Binding TodayCommand}"
                            Padding="10,5"/>
                    
                    <TextBlock Text="{Binding ActivePlan.PlanName, StringFormat='Активный план: {0}'}"
                               VerticalAlignment="Center"
                               Margin="20,0,0,0"
                               FontStyle="Italic"/>
                </StackPanel>
                
                <!-- Выбор плана -->
                <StackPanel Orientation="Horizontal">
                    <TextBlock Text="Выберите план:" 
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <ComboBox ItemsSource="{Binding Plans}"
                              SelectedItem="{Binding SelectedPlan}"
                              DisplayMemberPath="PlanName"
                              Width="200"/>
                </StackPanel>
            </StackPanel>
        </Border>
        
        <!-- Прогресс выполнения плана -->
        <GroupBox Grid.Row="2" Header="Прогресс выполнения плана" Padding="10">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>
                
                <!-- Статистика -->
                <StackPanel Grid.Column="0" Margin="0,0,10,0">
                    <TextBlock Text="Общая статистика:" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <StackPanel>
                        <TextBlock>
                            <Run Text="Калории:" FontWeight="SemiBold"/>
                            <Run Text="{Binding DailyProgress.TotalCalories, StringFormat={}{0:F0}}"/>
                            <Run Text="/"/>
                            <Run Text="{Binding SelectedPlan.DailyCalories}"/>
                            <Run Text="ккал"/>
                            <Run Text="{Binding DailyProgress.CaloriesProgress, StringFormat={}({0:F1}%)}"/>
                        </TextBlock>
                        
                        <TextBlock Margin="0,5,0,0">
                            <Run Text="Белки:" FontWeight="SemiBold"/>
                            <Run Text="{Binding DailyProgress.TotalProtein, StringFormat={}{0:F1}}"/>
                            <Run Text="/"/>
                            <Run Text="{Binding SelectedPlan.DailyProtein}"/>
                            <Run Text="г"/>
                            <Run Text="{Binding DailyProgress.ProteinProgress, StringFormat={}({0:F1}%)}"/>
                        </TextBlock>
                        
                        <TextBlock Margin="0,5,0,0">
                            <Run Text="Жиры:" FontWeight="SemiBold"/>
                            <Run Text="{Binding DailyProgress.TotalFat, StringFormat={}{0:F1}}"/>
                            <Run Text="/"/>
                            <Run Text="{Binding SelectedPlan.DailyFat}"/>
                            <Run Text="г"/>
                            <Run Text="{Binding DailyProgress.FatProgress, StringFormat={}({0:F1}%)}"/>
                        </TextBlock>
                        
                        <TextBlock Margin="0,5,0,0">
                            <Run Text="Углеводы:" FontWeight="SemiBold"/>
                            <Run Text="{Binding DailyProgress.TotalCarbs, StringFormat={}{0:F1}}"/>
                            <Run Text="/"/>
                            <Run Text="{Binding SelectedPlan.DailyCarbohydrates}"/>
                            <Run Text="г"/>
                            <Run Text="{Binding DailyProgress.CarbsProgress, StringFormat={}({0:F1}%)}"/>
                        </TextBlock>
                    </StackPanel>
                </StackPanel>
                
                <!-- Список приемов пищи -->
                <StackPanel Grid.Column="1">
                    <TextBlock Text="Приемы пищи за день:" FontWeight="Bold" Margin="0,0,0,10"/>
                    
                    <ScrollViewer MaxHeight="300" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding TodayMeals}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border BorderBrush="#E0E0E0" BorderThickness="1" 
                                            CornerRadius="3" Padding="10" Margin="0,0,0,5">
                                        <StackPanel>
                                            <TextBlock FontWeight="Bold" Text="{Binding MealName}"/>
                                            <TextBlock>
                                                <Run Text="Время:"/>
                                                <Run Text="{Binding MealTime, StringFormat=HH:mm}"/>
                                            </TextBlock>
                                            <TextBlock>
                                                <Run Text="Калории:"/>
                                                <Run Text="{Binding Calories, StringFormat={}{0:F0}}"/>
                                                <Run Text="ккал,"/>
                                                <Run Text="Б:"/>
                                                <Run Text="{Binding Protein, StringFormat={}{0:F1}}"/>
                                                <Run Text="г,"/>
                                                <Run Text="Ж:"/>
                                                <Run Text="{Binding Fat, StringFormat={}{0:F1}}"/>
                                                <Run Text="г,"/>
                                                <Run Text="У:"/>
                                                <Run Text="{Binding Carbs, StringFormat={}{0:F1}}"/>
                                                <Run Text="г"/>
                                            </TextBlock>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                    
                    <TextBlock Text="{Binding TodayMeals.Count, StringFormat='Всего приемов пищи: {0}'}"
                               FontStyle="Italic" Margin="0,10,0,0"/>
                </StackPanel>
            </Grid>
        </GroupBox>
        
        <!-- Кнопки действий -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,10,0,0">
            <Button Content="Просмотреть детали" 
                    Command="{Binding ViewPlanDetailsCommand}"
                    Padding="15,8"
                    Margin="0,0,10,0"
                    Width="150"/>
            
            <Button Content="Экспортировать план" 
                    Command="{Binding ExportPlanCommand}"
                    Padding="15,8"
                    Width="150"
                    Background="#2196F3"
                    Foreground="White"/>
        </StackPanel>
    </Grid>
</UserControl>